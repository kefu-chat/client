{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../Footer.svelte",
    "../../MessageInput.svelte",
    "../../MessageList.svelte",
    "../../Messages.svelte",
    "../../ScrollToBottom.svelte",
    "../../Input.svelte",
    "../../Nav.svelte",
    "../../Page.svelte"
  ],
  "sourcesContent": [
    "<footer>\n  Made with\n  <span>‚ô•Ô∏è</span>\n  by\n  <a href=\"https://koenvangilst.nl\">Koen van Gilst</a>\n  <br />\n  Using\n  <a href=\"https://svelte.dev/\">svelte</a>\n  and\n  <a href=\"https://gun.eco/\">gunDB</a>\n  see\n  <a href=\"https://github.com/vnglst/svelte-gundb-chat\">Github</a>\n  <br />\n  v. {\"0.9.0\"} git {\"488f976\"}\n</footer>\n\n<style>\n  footer {\n    color: grey;\n    margin: 4rem 0 1rem 0;\n    font-size: 10px;\n    text-align: center;\n    line-height: 1.6;\n  }\n\n  span {\n    color: red;\n  }\n</style>\n",
    "<script>\n  import { createEventDispatcher } from \"svelte\";\n  import { user } from \"./stores.js\";\n  import Input from \"./ui/Input.svelte\";\n  import { gun } from \"./initGun.js\";\n\n  const dispatch = createEventDispatcher();\n  let msgInput;\n</script>\n\n<div>\n  <form\n    method=\"get\"\n    autocomplete=\"off\"\n    on:submit|preventDefault={e => {\n      if (!msgInput || !msgInput.trim()) return;\n      dispatch('message', msgInput);\n      msgInput = '';\n      e.target.msg.focus();\n    }}\n  >\n    <Input\n      multiline\n      disabled={!$user}\n      maxRows={3}\n      bind:value={msgInput}\n      name=\"msg\"\n      placeholder=\"Message\"\n      ariaLabel=\"Message\"\n    />\n  </form>\n</div>\n\n<style>\n  div {\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    width: 100%;\n  }\n\n  form {\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    max-width: 640px;\n    background-color: white;\n    padding: 0.25em 1em;\n  }\n</style>\n",
    "<script>\n  import { createEventDispatcher } from \"svelte\";\n  import { fade, fly } from \"svelte/transition\";\n  import { user } from \"./stores.js\";\n  import { quintOut } from \"svelte/easing\";\n  import { crossfade } from \"svelte/transition\";\n  import { toHSL } from \"./toHSL.js\";\n\n  const dispatch = createEventDispatcher();\n\n  export let chats;\n\n  const [send, receive] = crossfade({\n    duration: (d) => Math.sqrt(d * 200),\n\n    fallback(node, params) {\n      const style = getComputedStyle(node);\n      const transform = style.transform === \"none\" ? \"\" : style.transform;\n\n      return {\n        duration: 600,\n        easing: quintOut,\n        css: (t) => `\n          transform: ${transform} scale(${t});\n          opacity: ${t}\n\t\t\t\t`,\n      };\n    },\n  });\n</script>\n\n{#each chats as chat (chat.msgId)}\n  <article\n    class:user={chat.user === $user}\n    in:fade\n    out:send={{ key: chat.msgId }}\n  >\n    <div class=\"meta\">\n      <span class=\"time\">\n        {new Date(parseFloat(chat.time)).toLocaleString('en-US', {\n          hour12: false,\n        })}\n      </span>\n      <span class=\"user\">{chat.user}</span>\n    </div>\n    <div\n      class=\"msg\"\n      style=\"background-color: {chat.user !== $user && toHSL(chat.user)}\"\n    >\n      {chat.msg}\n    </div>\n  </article>\n{/each}\n\n<style>\n  article {\n    margin: 1em 0;\n  }\n  .meta {\n    font-size: 10px;\n    margin: 0.5em;\n  }\n\n  .msg {\n    display: inline-block;\n    position: relative;\n    line-height: 1.8;\n    padding: 0.4em 1em;\n    background-color: #eee;\n    border-radius: 1em 1em 1em 0;\n\n    /* This makes sure returns are also rendered */\n    white-space: pre-wrap;\n\n    /* The trouble you have to go through to keep simple text inside a div! üòÜ */\n    /* Source: https://css-tricks.com/snippets/css/prevent-long-urls-from-breaking-out-of-container/ */\n\n    /* These are technically the same, but use both */\n    overflow-wrap: break-word;\n    word-wrap: break-word;\n\n    -ms-word-break: break-all;\n    /* This is the dangerous one in WebKit, as it breaks things wherever */\n    word-break: break-all;\n    /* Instead use this non-standard one: */\n    word-break: break-word;\n  }\n\n  .user {\n    text-align: right;\n  }\n\n  .user > .msg {\n    margin-left: 4em;\n    background-color: #0074d9;\n    color: white;\n    border-radius: 1em 1em 0 1em;\n  }\n\n  .msg:hover button {\n    opacity: 1;\n  }\n\n  button.delete {\n    position: absolute;\n    top: 0;\n    left: -2em;\n    width: 2em;\n    height: 100%;\n    background: no-repeat 50% 50% url(/trash.svg);\n    background-size: 1.4em 1.4em;\n    border: none;\n    opacity: 0;\n    transition: opacity 0.2s;\n    text-indent: -9999px;\n    cursor: pointer;\n  }\n</style>\n",
    "<script>\n  import { beforeUpdate, afterUpdate, onMount, onDestroy } from \"svelte\";\n  import { chatTopic, user } from \"./stores.js\";\n  import { gun } from \"./initGun.js\";\n  import ScrollToBottom from \"./ScrollToBottom.svelte\";\n  import MessageInput from \"./MessageInput.svelte\";\n  import MessageList from \"./MessageList.svelte\";\n  import Spinner from \"./ui/Spinner.svelte\";\n\n  const ADD_ON_SCROLL = 50; // messages to add when scrolling to the top\n  let showMessages = 100; // initial messages to load\n\n  let store = {};\n  let chats = [];\n  let autoscroll;\n  let showScrollToBottom;\n  let main;\n  let isLoading = false;\n  let timeout;\n\n  $: {\n    isLoading = true;\n    if (timeout) clearTimeout(timeout);\n    // debounce update svelte store to avoid overloading ui\n    timeout = setTimeout(() => {\n      // convert key/value object to sorted array of messages (with a max length)\n      const arr = Object.values(store);\n      const sorted = arr.sort((a, b) => a.time - b.time);\n      const begin = Math.max(0, sorted.length - showMessages);\n      const end = arr.length;\n      chats = arr.slice(begin, end);\n      isLoading = false;\n    }, 200);\n  }\n\n  function scrollToBottom() {\n    main.scrollTo({ left: 0, top: main.scrollHeight });\n  }\n\n  function handleScroll(e) {\n    showScrollToBottom =\n      main.scrollHeight - main.offsetHeight > main.scrollTop + 300;\n    if (!isLoading && main.scrollTop <= main.scrollHeight / 10) {\n      const totalMessages = Object.keys(store).length - 1;\n      if (showMessages >= totalMessages) return;\n      isLoading = true;\n      setTimeout(() => {\n        showMessages += ADD_ON_SCROLL;\n        if (main.scrollTop === 0) main.scrollTop = 1;\n        isLoading = false;\n      }, 200);\n    }\n  }\n\n  function handleNewMessage(msg) {\n    const now = new Date().getTime();\n    const message = { msg, user: $user, time: now };\n    gun.get($chatTopic).set(message);\n  }\n\n  function handleDelete(msgId) {\n    gun.get($chatTopic).get(msgId).put(null);\n  }\n\n  onMount(async () => {\n    gun\n      .get($chatTopic)\n      .map()\n      .on((val, msgId) => {\n        if (val) {\n          store[msgId] = { msgId, ...val };\n        } else {\n          // null messages are deleted\n          delete store[msgId];\n          // reassign store to trigger svelte's reactivity\n          store = store;\n        }\n      });\n    const arr = Object.values(store);\n    const sorted = arr.sort((a, b) => a.time - b.time);\n    const begin = Math.max(0, sorted.length - showMessages);\n    const end = arr.length;\n    chats = arr.slice(begin, end);\n    console.log(chats);\n  });\n\n  beforeUpdate(() => {\n    autoscroll =\n      main && main.offsetHeight + main.scrollTop > main.scrollHeight - 50;\n  });\n\n  afterUpdate(() => {\n    if (autoscroll) main.scrollTo(0, main.scrollHeight);\n  });\n\n  onDestroy(() => {\n    // remove gun listeners\n    gun.get($chatTopic).off();\n  });\n</script>\n\n<main bind:this={main} on:scroll={handleScroll}>\n  {#if isLoading}\n    <Spinner />\n  {/if}\n  <MessageList {chats} />\n</main>\n\n<MessageInput\n  on:message={(e) => {\n    console.log(e);\n    handleNewMessage(e.detail);\n    scrollToBottom();\n  }}\n/>\n\n{#if showScrollToBottom}\n  <ScrollToBottom onScroll={scrollToBottom} />\n{/if}\n\n<style>\n  main {\n    margin: auto 0 3em 0;\n    padding: 0.5em 1em 0.5em 1em;\n    overflow-y: auto;\n  }\n</style>\n",
    "<script>\n  import { fly } from \"svelte/transition\";\n  export let onScroll;\n</script>\n\n<div out:fly={{ x: 20, duration: 200 }} in:fly={{ x: 20, duration: 200 }}>\n  <button on:click|preventDefault={onScroll}>‚Üì</button>\n</div>\n\n<style>\n  div {\n    position: fixed;\n    bottom: 4em;\n    left: 0;\n    right: 0;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    align-items: flex-end;\n    max-width: 640px;\n  }\n\n  button {\n    margin-right: 1em;\n    text-align: center;\n    padding: 0.75em;\n    color: white;\n    font-size: 18px;\n    line-height: 1;\n    border: none;\n    border-radius: 50%;\n    background-color: #555555;\n    opacity: 0.9;\n  }\n</style>\n",
    "<script>\n  import { fade } from \"svelte/transition\";\n  import { createEventDispatcher } from \"svelte\";\n\n  export let ariaLabelledBy = null;\n  export let ariaLabel = null;\n  export let placeholder = null;\n  export let value = \"\";\n  export let name = null;\n  export let maxLength = 160;\n  export let maxRows = 1;\n  export let disabled = false;\n  export let multiline = false;\n\n  // TODO: kinda hacky, on desktop it's more that 40, but calculating chars per line is hard\n  // FIX: something along the lines of this: https://github.com/mui-org/material-ui/blob/master/packages/material-ui/src/TextareaAutosize/TextareaAutosize.js\n  const CHARS_PER_LINE = 40;\n\n  function calcRows(v) {\n    let textRows = Math.floor(v.length / CHARS_PER_LINE) + 1;\n    const numberOfReturns = (v.match(/\\n/g) || []).length;\n    textRows += numberOfReturns;\n    return Math.min(maxRows, textRows);\n  }\n\n  $: rows = calcRows(value);\n\n  function handleKeyPress(e) {\n    if (e.which === 13 && !e.shiftKey) {\n      // simulate actual submit event when user pressed return\n      // but not on 'soft return'\n      e.target.form.dispatchEvent(\n        new Event(\"submit\", {\n          cancelable: true\n        })\n      );\n      e.preventDefault();\n    }\n  }\n</script>\n\n<div class=\"input-with-button\">\n  {#if multiline}\n    <textarea\n      {disabled}\n      {rows}\n      class=\"input\"\n      type=\"text\"\n      {maxLength}\n      {name}\n      bind:value\n      on:keypress={handleKeyPress}\n      aria-labelledby={ariaLabelledBy}\n      aria-label={ariaLabel}\n      {placeholder}\n    />\n  {:else}\n    <input\n      {disabled}\n      {rows}\n      class=\"input\"\n      type=\"text\"\n      {maxLength}\n      {name}\n      bind:value\n      aria-labelledby={ariaLabelledBy}\n      aria-label={ariaLabel}\n      {placeholder}\n    />\n  {/if}\n  {#if value}\n    <input class=\"submit\" type=\"submit\" value=\"Send\" in:fade out:fade />\n  {/if}\n</div>\n\n<style>\n  .input-with-button {\n    position: relative;\n  }\n\n  .input {\n    padding: 0.6em 2em 0.6em 0.6em;\n    border-radius: 1em;\n    width: 100%;\n    resize: none;\n    /* fix for firefox showing two rows, see: \n        https://stackoverflow.com/questions/7695945/height-of-textarea-does-not-match-the-rows-in-firefox */\n    overflow-x: hidden;\n  }\n\n  .input:disabled {\n    background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAIklEQVQIW2NkQAKrVq36zwjjgzhhYWGMYAEYB8RmROaABADeOQ8CXl/xfgAAAABJRU5ErkJggg==)\n      repeat;\n    cursor: not-allowed;\n  }\n\n  .input:focus {\n    outline: none;\n    box-shadow: 0 0 0 3px rgba(0, 116, 217, 0.5);\n  }\n\n  .submit {\n    position: absolute;\n    top: 0.4em;\n    right: 0.4em;\n    width: 1.5em;\n    height: 1.5em;\n    background: no-repeat 50% 50% url(/up.svg);\n    background-size: 0.75em;\n    border: none;\n    border-radius: 50%;\n    background-color: #0074d9;\n    text-indent: -9999px;\n    cursor: pointer;\n  }\n</style>\n",
    "<script>\n  import { createEventDispatcher } from \"svelte\";\n  export let showBack = false;\n  export let backText = null;\n  const dispatch = createEventDispatcher();\n</script>\n\n<nav>\n  {#if showBack}\n    <button on:click={() => dispatch('back')}>\n      <svg\n        height=\"40\"\n        width=\"40\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path\n          fill=\"currentColor\"\n          d=\"M13.7 15.3a1 1 0 0 1-1.4 1.4l-4-4a1 1 0 0 1 0-1.4l4-4a1 1 0 0 1 1.4\n          1.4L10.42 12l3.3 3.3z\"\n        />\n      </svg>\n      {#if backText}\n        <span>{backText}</span>\n      {/if}\n    </button>\n  {/if}\n  <h1>\n    <slot />\n  </h1>\n</nav>\n\n<style>\n  nav {\n    position: -webkit-sticky;\n    position: sticky;\n    z-index: 10;\n    top: 0;\n    margin: 0;\n    padding: 0.75em 0;\n    display: flex;\n    border-bottom: 1px solid #eee;\n    background-color: white;\n    min-height: 3em;\n  }\n  button {\n    display: flex;\n    position: absolute;\n    left: 0.5em;\n    top: 0.37em;\n    border: none;\n    background-color: white;\n    align-items: center;\n    padding: 0;\n    color: #0074d9;\n  }\n  button:hover {\n    transition: 0.75s cubic-bezier(0, 1.2, 0.2, 1.5);\n    transform: scale(1.1);\n  }\n\n  span {\n    margin: 0 0 0 -1em;\n    font-size: 0.8em;\n  }\n\n  h1 {\n    margin: 0 auto;\n    font-size: 1.4em;\n  }\n</style>\n",
    "<script>\n  import { fade } from \"svelte/transition\";\n</script>\n\n<div class=\"animation\" in:fade out:fade>\n  <div class=\"container\">\n    <slot />\n  </div>\n</div>\n\n<style>\n  .animation {\n    position: absolute;\n    height: 100%;\n    width: 100vw;\n  }\n  .container {\n    height: 100%;\n    margin: 0 auto;\n    display: flex;\n    flex-direction: column;\n    max-width: 640px;\n    background-color: white;\n  }\n</style>\n"
  ],
  "names": [],
  "mappings": "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"
}